#!/bin/bash

# this sctipt simply invokes imbl-ui.py and cleans left over in /dev/shm/
# if required. May need it if the UI exits sub-normally, skipping clean-up step.

myloc="$(dirname "$(realpath "$0")" )"
uiexec="$(realpath "$myloc/../share/imblproc/imbl-ui.py")"
rmlist="FILES_IN_MEMORY"
export PYTHONUNBUFFERED="x"
export InMemIndicator="In-memory file to wipe: "
"$uiexec" \
| tee >( grep "$InMemIndicator" --line-buffered | sed -u "s_${InMemIndicator}__g"  > "$rmlist" ) \
| grep -v "$InMemIndicator" --line-buffered

cat "$rmlist" | sort | uniq |
while read flToRm ; do
    if [ -n "$flToRm" ] ; then
        rm "${flToRm}"* 2> /dev/null &
    fi
done
rm "$rmlist"

